<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSocial - Feed</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: #0f172a; border-bottom: 1px solid #334155; }
        .nav-link-custom { color: #38bdf8 !important; font-weight: bold; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .nav-link-custom:hover { color: #ffffff !important; }
        
        .card { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; backdrop-filter: blur(5px); }
        .form-control { background: #0f172a !important; color: white !important; border: 2px solid #334155 !important; border-radius: 12px; }
        ::placeholder { color: #94a3b8 !important; opacity: 1; }
        
        .upload-box { background: #1e293b; padding: 12px; border-radius: 12px; cursor: pointer; display: block; text-align: center; border: 2px dashed #6366f1; color: #818cf8; font-weight: bold; transition: 0.3s; }
        .upload-box:hover { background: #334155; border-color: #818cf8; }
        
        .pfp-main { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #6366f1; }
        .post-img { width: 100%; border-radius: 15px; margin-top: 12px; border: 1px solid #334155; }
        .delete-btn { font-size: 0.8rem; color: #ef4444; text-decoration: none; font-weight: bold; opacity: 0.7; transition: 0.3s; }
        .delete-btn:hover { opacity: 1; color: #f87171; }

        /* Badge positioning for your custom links */
        .badge-notif { font-size: 0.65rem; top: -5px !important; left: 90% !important; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark sticky-top mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold text-info" href="/">TECHSOCIAL</a>
        <div class="d-flex gap-4 align-items-center">
            <a href="/calendar" class="nav-link-custom position-relative">
                ðŸ—“ï¸ CALENDAR
                {% if unread_notifs > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle p-1 bg-warning border border-dark rounded-circle"></span>
                {% endif %}
            </a>

            <a href="/wallet" class="nav-link-custom position-relative">
                ðŸ’° WALLET
                {% if unread_notifs > 0 %}
                <span class="position-absolute badge rounded-pill bg-warning text-dark badge-notif">
                    {{ unread_notifs }}
                </span>
                {% endif %}
            </a>

            <div class="ms-2 d-flex gap-2">
                <a href="/settings" class="btn btn-outline-info btn-sm rounded-pill px-3">Settings</a>
                <a href="/logout" class="btn btn-danger btn-sm rounded-pill px-3">Logout</a>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <div class="card p-3 mb-4 shadow-sm">
                <h6 class="text-info fw-bold mb-3 small">SQUAD CHATS</h6>
                {% for u in users %}
                <a href="/messages/{{ u[0] }}" class="d-flex align-items-center text-white text-decoration-none mb-3 position-relative">
                    <img src="{{ u[2] or 'https://cdn-icons-png.flaticon.com/512/149/149071.png' }}" style="width:28px; height:28px; border-radius:50%;" class="me-2">
                    <span class="small">@{{ u[1] }}</span>
                    {% if unread_msgs > 0 %}
                    <span class="ms-auto badge rounded-pill bg-danger" style="font-size: 0.6rem;">NEW</span>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-9">
            <div class="card p-4 mb-5 shadow-lg">
                <form action="/post" method="POST" enctype="multipart/form-data">
                    <textarea name="content" class="form-control mb-3" rows="2" placeholder="What are you building today?" required></textarea>
                    
                    <label for="image_file" class="upload-box mb-3">ðŸ“¸ Select Image from Gallery</label>
                    <input type="file" name="image_file" id="image_file" class="d-none" accept="image/*">
                    
                    <button class="btn btn-primary w-100 fw-bold py-2 shadow">PUBLISH POST</button>
                </form>
            </div>

            <h4 class="text-info fw-bold mb-4">ðŸ“¢ Global Feed</h4>

            {% for p in posts %}
            <div class="card p-4 mb-4 shadow">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="d-flex align-items-center mb-3">
                        <img src="{{ p[4] or 'https://cdn-icons-png.flaticon.com/512/149/149071.png' }}" class="pfp-main me-3">
                        <div>
                            <div class="text-info fw-bold">@{{ p[0] }}</div>
                            <div class="text-white-50" style="font-size: 0.7rem;">Verified Member</div>
                        </div>
                    </div>

                    {% if p[3] == session['user_id'] %}
                        <a href="/delete/{{ p[2] }}" class="delete-btn" onclick="return confirm('Shred this post permanently?')">âœ• DELETE</a>
                    {% endif %}
                </div>

                <p style="color: #e2e8f0; font-size: 1.1rem; line-height: 1.5; margin-bottom: 0;">{{ p[1] }}</p>

                {% if p[5] %}
                    <img src="{{ p[5] }}" class="post-img shadow-sm" alt="Post content image">
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

</body>
</html>